<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>IMS - View Data</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 20px; }
        h2 { text-align: center; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background: #4CAF50; color: white; }
        .error { color: red; margin-top: 10px; }
        a { display: inline-block; margin-top: 10px; text-decoration: none; color: #fff; background: #4CAF50; padding: 8px 12px; border-radius: 4px; }
        a:hover { background: #45a049; }
    </style>
</head>
<body>

<h2>IMS - View Data</h2>

<div id="dataContainer"></div>

<a href="/frontend/menu/" id="backToMenu">Back to Menu</a>

<script>
    // Get access token and role from sessionStorage
    const accessToken = sessionStorage.getItem('access_token');
    const role = sessionStorage.getItem('role');

    // Redirect to login if not authenticated
    if (!accessToken || !role) {
        alert('You are not logged in. Redirecting to login.');
        window.location.href = '/login/';
    }

    // Table endpoints mapping
    const tables = {
        inventory: '/api/inventory/',
        purchases: '/api/purchases/',
        servicings: '/api/servicings/',
        rentals: '/api/rentals/',
        disposals: '/api/disposals/'
    };

    // Fetch and render data
    async function fetchTable(name, url) {
        try {
            const response = await fetch(url, {
                headers: {
                    'Authorization': `Bearer ${accessToken}`
                }
            });
            if (!response.ok) throw new Error(`Failed to fetch ${name} data`);
            const data = await response.json();
            renderTable(name, data);
        } catch (err) {
            const container = document.getElementById('dataContainer');
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = `${name} error: ${err.message}`;
            container.appendChild(errorDiv);
        }
    }

    // Render table into DOM
    function renderTable(name, data) {
        if (!Array.isArray(data) || data.length === 0) return;
        const container = document.getElementById('dataContainer');
        const table = document.createElement('table');

        // Table caption
        const caption = document.createElement('caption');
        caption.textContent = name.charAt(0).toUpperCase() + name.slice(1);
        table.appendChild(caption);

        // Table header
        const thead = document.createElement('thead');
        const headerRow = document.createElement('tr');
        Object.keys(data[0]).forEach(key => {
            const th = document.createElement('th');
            th.textContent = key;
            headerRow.appendChild(th);
        });
        thead.appendChild(headerRow);
        table.appendChild(thead);

        // Table body
        const tbody = document.createElement('tbody');
        data.forEach(item => {
            const row = document.createElement('tr');
            Object.values(item).forEach(value => {
                const td = document.createElement('td');
                td.textContent = value;
                row.appendChild(td);
            });
            tbody.appendChild(row);
        });
        table.appendChild(tbody);

        container.appendChild(table);
    }

    // Fetch all tables
    for (const [name, url] of Object.entries(tables)) {
        fetchTable(name, url);
    }
</script>

</body>
</html>